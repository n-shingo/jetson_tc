2017/10/23 by Shingo Nakamura

■ jetson_tc 
- つくばチャレンジ用プログラム
- ThetaS と Webカメラが接続された Jetson上で動く Pythonプログラム
- PC からの命令により、人検索や信号検出※を行う
- 現在の状態や結果を PC に返す
- 動作確認済みバージョン Python 2.7, chainer 1.23, OpenCV 3.1.0
                     ※現在、信号検出は実装していない

■ システム
- PC上の jetsonsvr プログラムから命令を受け、状態を返す
- jetsonsvrプログラムは別途必要
- Jetsonとの通信は UDP/IP で行っている
- jetsonsvrの送信ポートは実行の度に異なり、そこからJetosonのポート54113へ JetsonCommandを送る
- Jetsonからの受信はポート64113で受け取る. 
- Jetson側の送信ポートは何でも良いが、jetson_tcというプログラム(Python)は54112を使っている

-----------------------------------           ----------------------
PC                                |           |  JETSON            |
  ----------     ---------------  |           |  ---------------   |
  | SSM    |     | jetsonsvr   |  |  Jetson   |  |  jetson_tc  |   |   ------------
  |        |     |             |  |  Command  |  |    (Python) | <==== |  ThetaS  |
  |        | ==> |  (Any Ports)| ==============> |(54113)      |   |   ------------
  |        |     |             |  |           |  |             |   |
  |        |     |             |  |           |  |             |   |   ------------
  |        | <== |      (64113)| <============== |(54112)      | <==== |Web Camera|
  |        |     |             |  |  Jetson   |  |             |   |   ------------
  ----------     ---------------  |  Status   |  |             |   |
                                  |           |  ---------------   |
-----------------------------------           ----------------------


■通信データ内容
- Jetson Command
  コマンドは1項目で整数値[1,2,3]のいずれかの値
  1.command
     1: Idling ( 何もするな )
     2: Search Person ( 人探せ )
     3: Detect Signal ( 信号検出せよ )
  
- Jetson Status
  Jetsonの状態を表すデータ．６つの項目からなる．
  1.jetsonStatus (Jetson状態)
     0: 異常( Jetsonから1秒以上通信が無い )
     1: Idling中
     2: 人検探索中
     3: 信号検出中
  2.thetasStatus (ThetaSの状態)
     0: 異常( ThetaSのデータが取得できない )
     1: 正常( ThetaSのデータを取得できている )
  3.webcamStatus (Webカメラ の状態)
     0: 異常( Webカメラのデータが取得できない )
     1: 正常( Webカメラのデータを取得できている )
  4.personResult (人探索結果)
     0: その他 ( 人検出していない時や異常時の時など )
     1: 発見した
     2: 発見なし
  5.personPos (人を発見した時の人の位置)
     [-Pi, +Pi] の実数値．単位はラジアン.
  6.signalResult (信号検出結果)
     0: その他 ( 信号検出していない時や異常時の時など )
     1: 青
     2: 赤
     3: 消灯中


■ プログラムの実行
- 実行前にソース jetson_tc.py の書き換え
  使用する PC と Jetson のIPに書き換える
  11行目: PC_IP = "172.29.***.***";
  12行目: JETSON_IP = "172.29.***.***";


■ その他
- OpenCV用のカメラIDは自動で検出するので設定は不要
- TCP ではなく UDPを使っているので、PC側(jetsonsvr)がなくても単体でプログラムは動作可能
  ※ UDP通信とは一方的にデータを送りつけるだけの通信です
- Ctrl-C でプログラム終了
- 人検出のプログラムを改善する必要がある．処理が重く、精度が悪い．
